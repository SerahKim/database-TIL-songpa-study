# ğŸ—“ï¸ 2025.05.21 (ìˆ˜) â€“ êµìœ¡ ì¼ì§€

## ğŸ“š ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©

### JDBC
- JDBC(Java DataBase Connectivity)
  - JDBCë€?
    - Java ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ ë° ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜, ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ Javaì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ìë°” API
    - ì¦‰, Javaì™€ DataBaseë¥¼ ì—°ê²°í•˜ëŠ” API
  - JDBC í‘œì¤€ ì¸í„°í˜ì´ìŠ¤
    ![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FIS7Q7%2FbtrR4G2GJPN%2FU3k0zntzKSMYLO3HJC8431%2Fimg.png)
    - JDBCëŠ” 3ê°€ì§€ í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•˜ì—¬ ì œê³µí•œë‹¤.
      - java.sql.Connection : ì—°ê²°
      - java.sql.Statement : SQLì„ ë‹´ì€ ë‚´ìš©
      - java.sql.ResultSet : SQL ìš”ì²­ ì‘ë‹µ
  - JDBC ë™ì‘ íë¦„
    ![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbHk4IH%2FbtrR2EZokg5%2FVlsEZPLukP9YKb7tK0paT1%2Fimg.png)
  - JDBC API ì‚¬ìš© íë¦„
    ![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FwTyMC%2FbtrR5yww0DA%2Fjwst72s4xtTKhLTtzfJ0mK%2Fimg.png)
- JDBC API í™˜ê²½ì„¸íŒ…
  1. JDBC ë“œë¼ì´ë²„ ì„ íƒ ë° `build.gradle`ì— dependencies ì¶”ê°€í•˜ê¸°
     ```
     // https://mvnrepository.com/artifact/mysql/mysql-connector-java
     // ë²„ì „ì€ ì–¸ì œë“  ë°”ë€” ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ„ì˜ ì£¼ì†Œì—ì„œ í™•ì¸ì„ í•´ì¤˜ì•¼í•œë‹¤.
     
     implementation("mysql:mysql-connector-java:8.0.33")
     ```
  2. JDBC ë“œë¼ì´ë²„ ë¡œë”©(ë“±ë¡)
     - `Class.forName()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë“œë¼ì´ë²„ì˜ í´ë˜ìŠ¤ íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ë¡œë“œ
       ```
       Class.forName(String JDBC Driverì˜ ì£¼ì†Œ);
       ```
       - MySQLì˜ Driver ì£¼ì†Œ : com.mysql.cj.jdbc.Driver
       - DriverManagerëŠ” ìê¸°ê°€ ì§ì ‘ ë“œë¼ì´ë²„ë¥¼ ë§Œë“¤ê±°ë‚˜ ë“±ë¡í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Class.forName("ë“œë¼ì´ë²„í´ë˜ìŠ¤")ë©”ì†Œë“œë¥¼ í†µí•´ JDBC ë“œë¼ì´ë²„ í´ë˜ìŠ¤ë¥¼ JVMì— ë¡œë“œí•˜ê³ ,
         ê·¸ ë“œë¼ì´ë²„ í´ë˜ìŠ¤ê°€ ìŠ¤ìŠ¤ë¡œ DriverManagerì— ë“±ë¡í•¨. 
       - ì´í›„ì— DriverManager.getConnection(...)ì„ í˜¸ì¶œí•˜ë©´, ë“±ë¡ëœ ë“œë¼ì´ë²„ë“¤ ì¤‘ì—ì„œ ì ì ˆí•œ ë“œë¼ì´ë²„ë¥¼ ì°¾ì•„ì„œ DB ì—°ê²°ì„ ìˆ˜í–‰
     - `ClassNotFoundException` ì˜ˆì™¸ ì²˜ë¦¬ í•„ìˆ˜
  3. Connection ê°ì²´ ìƒì„±
     - ì²˜ìŒ Connection ì¸í„°í˜ì´ìŠ¤ëŠ” nullë¡œ ì´ˆê¸°í™”í•´ì¤€ë‹¤.
       ```
       Connection con = null;
       ```
     - `DriverManager.getConnection()`ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Connection ê°ì²´ ìƒì„±
       ```
       // .properties íŒŒì¼ì— Driver ì£¼ì†Œ, url, user, passwordì— ëŒ€í•œ ì •ë³´ê°€ key-value í˜•ì‹ìœ¼ë¡œ ë‹´ê²¨ ìˆë‹¤.
       // Propertiesì˜ load(new FileReader(String fileName) ë©”ì†Œë“œë¥¼ í†µí•´ .properties íŒŒì¼ì„ ì½ì–´ì˜¨ë‹¤.
       
       con = DriverManager.getConnection(url, prop);
       con = DriverManager.getConnection("jdbc:mysql://localhost/employeedb", "ohgiraffers", "ohgiraffers");
       ```
       - MYSQL url í˜•ì‹ : jdbc:mysql://hostname/dbname
     - `getConnection()`ë©”ì†Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì˜¤ë²„ë¡œë“œë˜ì–´ ìˆë‹¤.
       - getConnection(String url)
       - getConnection(String url, Properties prop)
       - getConnection(String url, String user, String password)
     - `SQLException` ì˜ˆì™¸ ì²˜ë¦¬ í•„ìˆ˜
  4. Connection ìì› ë°˜ë‚©
     - `close()` ë©”ì†Œë“œë¥¼ í†µí•´ ìì› ë°˜ë‚©
        ````
        try {
               if (con != null && !con.isClosed()) {
                   con.close();
               }
           } catch (SQLException e) {
               throw new RuntimeException(e);
        }
        ````   
     - ìì› ë°˜ë‚©ì„ í•´ì¤˜ì•¼í•˜ëŠ” ì´ìœ 
       - ì‹¤ì œ DB ì„œë²„ëŠ” ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì—°ê²° ìˆ˜(Connection Pool)ë¥¼ ê°–ê³  ìˆì–´ DB ì—°ê²° ìì›ì€ í•œì •ì ì´ë‹¤. 
       - close()ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´ ê·¸ ì—°ê²°ì´ í•´ì œë˜ì§€ ì•Šê³  ê³„ì† ì ìœ ë˜ê¸° ë•Œë¬¸ì— ê²°ê³¼ì ìœ¼ë¡œ ìƒˆë¡œìš´ ì—°ê²°ì„ ë§ºê³  ì‹¶ì€ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²° ì˜¤ë¥˜(Connection timeout)ë¥¼ ê²ªì„ ìˆ˜ ìˆë‹¤. 
       - ì—°ê²°ëœ Connection, Statement, ResultSet ë“±ì€ ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ì–‘í•œ ë©”ëª¨ë¦¬ë¥¼ ì¡ê³  ìˆì–´, close()ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´ GC(ê°€ë¹„ì§€ ì»¬ë ‰ì…˜) ëŒ€ìƒì´ ë˜ì§€ ì•Šê¸° ë–„ë¬¸ì— ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- JDBC API ì‚¬ìš©í•˜ê¸°
  1. JDBC ë“œë¼ì´ë²„ ë¡œë”© í›„ Connection ê°ì²´ ìƒì„± (API í™˜ê²½ ì„¸íŒ…, ì£¼ë¡œ JDBCTeamplate í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©)
  2. SQL ì‹¤í–‰ì„ ìœ„í•œ Statement ê°ì²´ ìƒì„±
     - Statement
       - ì •ì  ì¿¼ë¦¬ ì‹¤í–‰ì— ì‚¬ìš©
       - ì¿¼ë¦¬ì— ë³€ìˆ˜ ê°’ì„ ì§ì ‘ ë¬¸ìì—´ë¡œ ì—°ê²°í•´ì•¼ í•˜ë¯€ë¡œ SQL Injectionì— ì·¨ì•½
       - ì²˜ìŒ Statement ì¸í„°í˜ì´ìŠ¤ëŠ” nullë¡œ ì´ˆê¸°í™”í•œë‹¤.
         ```
         Statement stmt = null;
         ```
       - Connectionì˜ `createStatement()`ë©”ì†Œë“œë¥¼ ì´ìš©í•´ Statement ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
         ```
         stmt = con.createStatement();
         ```
       - `SQLException` ì˜ˆì™¸ ì²˜ë¦¬ í•„ìˆ˜
     - PrepareStatement
       - ë™ì  ì¿¼ë¦¬(ë³€ìˆ˜ ë°”ì¸ë”©) ì‹¤í–‰ì— ì í•©
       - SQL Injection ë°©ì§€, ì„±ëŠ¥ í–¥ìƒ
       - ì¿¼ë¦¬ êµ¬ì¡°ë¥¼ ë¨¼ì € ì •ì˜í•˜ê³  ?ì— ê°’ì„ ë°”ì¸ë”©
       - PrepareStatementëŠ” Statement ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤
       - ì²˜ìŒ PrepareStatement ì¸í„°í˜ì´ìŠ¤ë¥¼ nullë¡œ ì´ˆê¸°í™”
         ```
         PreparedStatement pstmt = null;
         ```
       - Connectionì˜ `prepareStatement()`ë©”ì†Œë“œë¥¼ ì´ìš©í•´ PreparedStatement ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
         ```
         // prepareStatement()ì— ì¿¼ë¦¬ë¬¸ì„ ë„£ì–´ì¤€ë‹¤.
         
         pstmt = con.prepareStatement("SELECT EMP_ID, EMP_NAME FROM EMPLOYEE");
         ```
  3. Query ì‹¤í–‰
     - Statement ê°ì²´
       - Statementì˜ `executeQuery()`ë©”ì†Œë“œì— ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì…ë ¥í•˜ì—¬ ì¿¼ë¦¬ ì‹¤í–‰
       - ì‹¤í–‰í•  SQLë¬¸ì„ ë¬¸ìì—´ ë³€ìˆ˜ì— ì €ì¥í•œ ë’¤, í•´ë‹¹ ë³€ìˆ˜ë¥¼ `executeQuery()` ë©”ì†Œë“œì˜ ì¸ìë¡œ ë„˜ê²¨ì¤Œìœ¼ë¡œì¨ ì¿¼ë¦¬ ì‹¤í–‰
       - .xml íŒŒì¼ì— ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•˜ê³  entry key ê°’ì„ í†µí•´ í•´ë‹¹ ì¿¼ë¦¬ë¬¸ì„ ì¶”ì¶œí•˜ì—¬ ì‹¤í–‰
         ```
         // select ê²°ê³¼ ì§‘í•©ì„ ë°›ì•„ì˜¬ ìš©ë„ì˜ ì¸í„°í˜ì´ìŠ¤
         ResultSet rset = null;
         
         rset = stmt.executeQuery("SELECT EMP_ID, EMP_NAME FROM EMPLOYEE");
         
         String query = "SELECT EMP_ID, EMP_NAME FROM EMPLOYEE WHERE EMP_ID = '" + empId + "'";
         rset = stmt.executeQuery(query);
         
         Properties prop = new Properties();
         prop.loadFromXML(new FileInputStream("src/main/java/com/chapter02_statement/preparedstatement/employee-query.xml"));
         String query = prop.getProperty("selectEmpByFamilyName");
         rset = stmt.executeQuery(query);
         ```
     - PrepareStatement ê°ì²´
       - ìœ„ì¹˜ í™€ë”ë¥¼ í†µí•´ ê°’ì„ ë°”ì¸ë”© í•´ì¤€ í›„ ì‹¤í–‰
         ```
         // ë°”ì¸ë”© í•´ì¤˜ì•¼í•˜ëŠ” ê°’ì˜ ìë£Œí˜•ì— ë”°ë¼ ë©”ì†Œë“œê°€ ë°”ë€ë‹¤.
         // setString, setInt, setDouble...
         // ì²«ë²ˆì§¸ ìœ„ì¹˜ í™€ë”ì— empIdë¡œ ê°’ì„ ë°”ì¸ë”©
         pstmt.setString(1, empId); 
         rset = pstmt.executeQuery();
         ```
  4. ResultSet ê°ì²´ë¡œë¶€í„° ë°ì´í„° ì¡°íšŒ
     - í–‰ì´ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°
       - `while (rset.next())`ë¥¼ í†µí•´ ë°˜ë³µì ìœ¼ë¡œ ê²°ê³¼ ì½ê¸°
     - í–‰ì´ í•˜ë‚˜ì¸ ê²½ìš°
       - `if (rset.next())`ë¥¼ í†µí•´ ê²°ê³¼ ì½ê¸°
     - `next()`ë©”ì†Œë“œ : ResultSetì˜ ì»¤ì„œ ìœ„ì¹˜ë¥¼ í•˜ë‚˜ ë‚´ë¦¬ë©´ì„œ í–‰ì´ ì¡´ì¬í•˜ë©´ true, ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ falseë¥¼ ë°˜í™˜
     - `getString(String columnLabel)`ë©”ì†Œë“œ : ResultSetì˜ ì»¬ëŸ¼ëª…ì— í•´ë‹¹í•˜ëŠ” ê°’ë“¤ì„ ë°˜í™˜
       ```
       while (rset.next()) {
                System.out.println(rset.getString("EMP_ID") + ", " + rset.getString("EMP_NAME") );
       }
       ```
  5. ResultSet, Statement, Connection ê°ì²´ Close
     - ìˆœì„œë¥¼ ì§€í‚¤ì§€ ì•Šì•„ë„ ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ ë  ìˆ˜ ìˆìœ¼ë©´ ResultSet, Statement / PreparedStatement, Connection ìˆœìœ¼ë¡œ ë‹«ëŠ” ê²ƒì´ ì¢‹ë‹¤.
     - ê° ê°ì²´ë“¤ì€ ì„œë¡œ ì—°ê²°ëœ ìƒíƒœë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì—, ë°˜ëŒ€ë¡œ ë‹«ì•„ì•¼ ì•ˆì „í•˜ê²Œ ìì›ì„ ë°˜ë‚©í•œë‹¤.
     - ë³´í†µ JDBCTemplate.close()ë¥¼ í†µí•´ ì •ë¦¬í•œë‹¤.
        ````
       finally {
            close(rset);
            close(stmt);
            close(con);
        }
        ````

## ğŸ’» ì‹¤ìŠµ ì˜ˆì‹œ

### JDBC
- [JDBC API í™˜ê²½ì„¸íŒ…](../../JDBC/src/main/java/com/chapter01_connection)
- [ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ JDBC API ì‚¬ìš©í•˜ê¸°](../../JDBC/src/main/java/com/chapter02_statement)

## âœï¸ ì˜¤ëŠ˜ì˜ íšŒê³ 
- ì˜¤ëŠ˜ì€ JDBCì— ëŒ€í•´ ë°°ì› ë‹¤. ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ì ‘ê·¼í•˜ê³  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤ëŠ” ê²Œ ì‹ ê¸°í–ˆë‹¤.
- ì²˜ìŒì—ëŠ” ë“œë¼ì´ë²„ ë¡œë”©í•˜ê³ , Connection ë§Œë“¤ê³ , Statementë¡œ SQL ë‚ ë¦¬ê³ , ê²°ê³¼ë¥¼ ResultSetìœ¼ë¡œ ë°›ëŠ” íë¦„ì´ ë¨¸ë¦¿ì†ì— ì˜ ê·¸ë ¤ì§€ì§€ ì•Šì•˜ì§€ë§Œ, ë°˜ë³µí•˜ì—¬ ì‘ì„±í•˜ë‹¤ë³´ë‹ˆ ì–´ëŠ ì •ë„ ìµìˆ™í•´ì¡Œë‹¤. 
- ì²˜ìŒ ì ‘í•˜ëŠ” ê°œë…ì´ë¼ ì•„ì§ ì™„ì „íˆ ìµìˆ™í•˜ì§„ ì•Šì§€ë§Œ, ì „ì²´ êµ¬ì¡°ë¥¼ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•´ë³´ë‹ˆê¹Œ ì—°ê²° íë¦„ì€ ì–´ëŠ ì •ë„ ìµìˆ™í•´ì¡Œë‹¤. ì•ìœ¼ë¡œ PreparedStatement ì“°ëŠ” ë°©ë²•ì´ë‚˜ ìì› ë°˜ë‚© ì²˜ë¦¬ ê°™ì€ ê²ƒë„ ì‹¤ìŠµí•˜ë©´ì„œ ë” ìì—°ìŠ¤ëŸ½ê²Œ ìµíˆê³  ì‹¶ë‹¤.